<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Producto - Tecnología solar para Cuba</title>

  <link rel="icon" href="favicon.png" type="image/png">
  <link id="theme-style" rel="stylesheet" href="assets/css/style-day.css">

  
</head>

<body>

  <header class="topbar">
    <div class="logo">
      <a href="index.html">
        <img src="logo.png" alt="SolarCity logo" style="height:80px;">
      </a>
    </div>

    <nav>
      <a href="categoria.html?cat=powerbanks">Powerbanks</a>
      <a href="categoria.html?cat=paneles">Paneles</a>
      <a href="categoria.html?cat=luces">Luces</a>
      <a href="categoria.html?cat=sistemas">Sistemas</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </header>

  <main class="product-page">

    <div class="product-container">

      <div>
        <div class="product-image">
          <img id="p-img" src="" alt="" loading="lazy">
        </div>

        <div id="galerie" class="product-gallery"></div>
      </div>

      <div class="product-info">
        <h1 id="p-nazev"></h1>
        <div class="product-price" id="p-cena"></div>

        <div class="product-description" id="p-popis"></div>

        <button class="product-order-btn" onclick="window.location.href='contacto.html'">
          ORDENAR
        </button>
      </div>

    </div>

  </main>

  <footer>
    <p><a href="admin/login.html">Admin</a> © 2026 Tecnología Solar para el Caribe</p>
  </footer>

  <!-- LIGHTBOX -->
  <div id="lightbox" onclick="closeLightbox()">
    <img id="lightbox-img" src="" alt="">
  </div>

  <script>
    const slug = new URLSearchParams(window.location.search).get("slug");

    async function nactiDetailProduktu() {
      const apiUrl = "https://api.github.com/repos/czepepe-dev/solarcity/contents/data/productos";
      const files = await fetch(apiUrl).then(r => r.json());

      let jsonFiles = files.filter(f => f.name.endsWith(".json")).map(f => f.name);

      for (const file of jsonFiles) {
        const data = await fetch(`/data/productos/${file}`).then(r => r.json());

        if (!data.slug) {
          data.slug = data.nombre
            .toLowerCase()
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/^-+|-+$/g, "");
        }

        if (data.slug === slug) {
          zobrazProdukt(data);
          return;
        }
      }

      document.querySelector(".product-page").innerHTML =
        "<p>Producto no encontrado.</p>";
    }

    async function zobrazProdukt(p) {

      document.getElementById("p-img").src = p.imagen;
      document.getElementById("p-nazev").textContent = p.nombre;
      document.getElementById("p-cena").textContent = p.precio;

      let popis = p.descripcion
        .replace(/<!--StartFragment-->/g, "")
        .replace(/<!--EndFragment-->/g, "")
        .trim();

      document.getElementById("p-popis").innerHTML = marked.parse(popis);

      document.querySelectorAll("#p-popis img").forEach(img => {
        img.style.cursor = "pointer";
        img.onclick = () => openLightbox(img.src);
      });

      /* -------------------------------
         NOVÁ GALERIE Z JSONU
      --------------------------------*/
      const gal = document.getElementById("galerie");
      gal.innerHTML = "";

      if (Array.isArray(p.galeria) && p.galeria.length > 0) {
        p.galeria.forEach(item => {
          gal.innerHTML += `
            <img src="${item.imagen}" loading="lazy" onclick="openLightbox('${item.imagen}')">
          `;
        });
      }
    }

    /* --- LIGHTBOX FUNKCE S ANIMACÍ --- */
    function openLightbox(src) {
      const lb = document.getElementById("lightbox");
      const img = document.getElementById("lightbox-img");

      img.src = src;
      lb.style.display = "flex";

      setTimeout(() => lb.classList.add("show"), 10);
    }

    function closeLightbox() {
      const lb = document.getElementById("lightbox");
      lb.classList.remove("show");

      setTimeout(() => {
        lb.style.display = "none";
      }, 250);
    }

    nactiDetailProduktu();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
